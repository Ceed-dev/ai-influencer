# 開発ロードマップ

> v5.0の週単位開発スケジュール、マイルストーン、依存関係、リスクバッファを定義する
>
> **開始日**: 2026-02-16 (月)
>
> **開発体制**: エンジニア1名 (Shungo) フルタイム、月〜土勤務 (日曜休み)
>
> **想定完了**: 2026-06-27 (19週間)
>
> **関連ドキュメント**: [02-architecture.md](02-architecture.md) (アーキテクチャ), [03-database-schema.md](03-database-schema.md) (スキーマ), [04-agent-design.md](04-agent-design.md) (エージェント設計)

## 目次

- [1. フェーズ概要](#1-フェーズ概要)
- [2. 週単位スケジュール (ガントチャート)](#2-週単位スケジュール-ガントチャート)
- [3. 週単位の詳細計画](#3-週単位の詳細計画)
  - [Phase 1: データ基盤 (Week 1-3)](#phase-1-データ基盤-week-1-3)
  - [Phase 2: ワーカー層 (Week 4-6)](#phase-2-ワーカー層-week-4-6)
  - [Phase 3: インテリジェンス層 (Week 7-10)](#phase-3-インテリジェンス層-week-7-10)
  - [Phase 4: 戦略・計画層 (Week 11-14)](#phase-4-戦略計画層-week-11-14)
  - [Phase 5: ダッシュボード + スケール (Week 15-19)](#phase-5-ダッシュボード--スケール-week-15-19)
- [4. マイルストーン](#4-マイルストーン)
  - [マイルストーン判定チェックリスト](#マイルストーン判定チェックリスト)
- [5. 依存関係](#5-依存関係)
  - [5.1 フェーズ間の依存](#51-フェーズ間の依存)
  - [5.2 フェーズ内の依存](#52-フェーズ内の依存)
  - [5.3 外部依存](#53-外部依存)
- [6. 並行運用計画](#6-並行運用計画)
  - [6.1 v4.0 → v5.0 の切替タイムライン](#61-v40--v50-の切替タイムライン)
  - [6.2 切替ルール](#62-切替ルール)
  - [6.3 並行運用期間のデータ整合性](#63-並行運用期間のデータ整合性)
- [7. リスクバッファ](#7-リスクバッファ)
  - [7.1 フェーズ別リスクと対策](#71-フェーズ別リスクと対策)
  - [7.2 バッファの運用方針](#72-バッファの運用方針)
- [8. KPIとの整合性](#8-kpiとの整合性)
  - [8.1 フェーズ完了とKPI目標の対応](#81-フェーズ完了とkpi目標の対応)
  - [8.2 KPI達成に必要な制作能力](#82-kpi達成に必要な制作能力)
  - [8.3 各フェーズが遅延した場合のKPI影響](#83-各フェーズが遅延した場合のkpi影響)
- [9. 前提条件](#9-前提条件)
  - [9.1 開発リソース](#91-開発リソース)
  - [9.2 インフラ](#92-インフラ)
  - [9.3 外部サービス](#93-外部サービス)
  - [9.4 技術前提](#94-技術前提)
- [10. 週次レビュー計画](#10-週次レビュー計画)


## 1. フェーズ概要

v5.0の開発は5フェーズに分割する。各フェーズは前フェーズの成果物に依存するため、基本的に直列で進行する。ただし、プラットフォームAPI審査の申請は Phase 1 から並行して開始する。

| Phase | 名称 | 期間 | 週数 | 目的 | 主要成果物 |
|-------|------|------|------|------|-----------|
| 1 | データ基盤 | 2/16 - 3/7 | 3週 | 全データの一元管理基盤を構築 | Docker環境 + PostgreSQL (25テーブル) + pgvector + MCP Server + データ移行完了 |
| 2 | ワーカー層 | 3/9 - 3/28 | 3週 | DB駆動のパイプラインを稼働させる | 動画制作・テキスト制作・投稿・計測ワーカーがDB起点で動作 + Docker化 |
| 3 | インテリジェンス層 | 3/30 - 4/25 | 4週 | AIが自律的に市場調査・分析・学習・データキュレーションする | リサーチャー + アナリスト + ツールスペシャリスト + データキュレーター + 仮説検証 + pgvector検索 + コンポーネント自動生成 + プロンプト自動提案 |
| 4 | 戦略・計画層 | 4/27 - 5/23 | 4週 | 全自動サイクルを完成させる | 戦略Agent + プランナー + 全プラットフォーム対応 |
| 5 | ダッシュボード + スケール | 5/25 - 6/27 | 5週 | 人間の監視UI + 3,500アカウント対応 | Next.js Dashboard + ツール管理画面 + プロンプト改善パネル + Docker完全移行 + 本番運用 |

## 2. 週単位スケジュール (ガントチャート)

```
2026年
         2月              3月                  4月                  5月                  6月
Week  W1   W2   W3   W4   W5   W6   W7   W8   W9   W10  W11  W12  W13  W14  W15  W16  W17  W18  W19
日付  2/16 2/23 3/2  3/9  3/16 3/23 3/30 4/6  4/13 4/20 4/27 5/4  5/11 5/18 5/25 6/1  6/8  6/15 6/22
      ──── ──── ──── ──── ──── ──── ──── ──── ──── ──── ──── ──── ──── ──── ──── ──── ──── ──── ────

Phase 1: データ基盤
      ████ ████ ████
      Docker スキ  MCP
      +DB    ーマ  Server
      構築  25tbl

Phase 2: ワーカー層
                     ████ ████ ████
                     動画+ 投稿  計測+
                     テキスト WK  ツールMCP
                     制作WK      +Docker化

Phase 3: インテリジェンス層
                                    ████ ████ ████ ████
                                    LG   リサ  アナ  Embed
                                    +ツール ーチ+ リスト+ +データ
                                    SP   学習  提案  キュレータ

Phase 4: 戦略・計画層
                                                       ████ ████ ████ ████
                                                       戦略  プラン 自動  マルチ
                                                       Agent ナー  サイクル PF

Phase 5: ダッシュボード + スケール
                                                                          ████ ████ ████ ████ ████
                                                                          UI+  介入+ Docker 完全  本番
                                                                          Docker ツール 移行  分離  運用
                                                                               管理

v4.0並行運用
      ═══════════════════════════════
      v4.0稼働中（Phase 2完了まで）

Docker化進行
      ────────────────────────────────────────────────────────────────────────────────────────
      W1:DB   W4:制作WK  W6:MCP  W7:Agent  W15:Dashboard  W18:PM2廃止→Docker完全移行

API審査申請 (並行)
      ──────────────────────────────────────────────
      YouTube OAuth    TikTok審査    Instagram審査   X API申請
      (W1〜)           (W1〜)        (W1〜)          (W1〜)

KPI目標
      50              160                340                1,480              3,500
      (2月)            (3月)              (4月)               (5月)              (6月)

マイルストーン
      ▲                    ▲              ▲                   ▲                   ▲
      M1                   M2             M3                  M4                  M5
      Docker+DB            DB駆動PL       AI学習+             全自動               Docker
      25tbl稼働            +Docker化      ツールSP             サイクル              完全移行
                                                                                  +本番
```

**凡例**:
- `████` = 開発作業期間
- `════` = v4.0並行運用期間
- `────` = 並行作業 (バックグラウンド)
- `▲` = マイルストーン

## 3. 週単位の詳細計画

### Phase 1: データ基盤 (Week 1-3)

**目的**: Docker環境を構築し、全データをPostgreSQL + pgvectorに一元管理し、MCP Serverで外部からアクセス可能にする

**v4.0との関係**: v4.0パイプラインは変更せず稼働継続。Sheetsデータを読み取ってPostgreSQLにコピーする（Sheetsは引き続き正のソース）

#### Week 1 (2/16 - 2/21): Docker環境構築 + PostgreSQLセットアップ + Entityテーブル

| 日 | 作業内容 | 成果物 |
|----|---------|--------|
| 月 | Docker環境構築: `docker-compose.yml` 作成、PostgreSQL 16+ + pgvector をDockerコンテナ化 (`pgvector/pgvector:pg16`イメージ使用)。`docker-compose.dev.yml` / `docker-compose.prod.yml` の分離設計、`.env.dev` / `.env.prod` の分離 | Docker環境稼働、PostgreSQL接続確認、dev/prod分離設計完了 |
| 火 | pgvector拡張インストール、ベクトル検索動作確認 | `CREATE EXTENSION vector` 成功 |
| 水 | `accounts` テーブル作成 + インデックス | Accountsテーブル稼働、INSERTテスト |
| 木 | `characters` テーブル作成 + インデックス | Charactersテーブル稼働 |
| 金 | `components` テーブル作成 + GINインデックス (tags) | Componentsテーブル稼働 |
| 土 | Entity層の結合テスト、バリデーション関数作成 | Entity 3テーブル完成 |

#### Week 2 (2/23 - 2/28): 残テーブル + データ移行

| 日 | 作業内容 | 成果物 |
|----|---------|--------|
| 月 | `content` + `content_sections` + `publications` テーブル作成 (Production) | Production 3テーブル |
| 火 | `hypotheses` + `market_intel` テーブル + HNSWインデックス | Intelligence前半 |
| 水 | `metrics` + `analyses` + `learnings` テーブル | Intelligence後半 |
| 木 | `cycles` + `human_directives` + `task_queue` + `algorithm_performance` + `agent_prompt_versions` + `agent_thought_logs` + `agent_reflections` + `agent_individual_learnings` + `agent_communications` | Operations 4テーブル + Observability 5テーブル |
| 金 | `tool_catalog` + `tool_experiences` + `tool_external_sources` + `production_recipes` + `prompt_suggestions` テーブル作成 (Tool Management)。全トリガー作成 (`updated_at` 自動更新) + 全インデックス確認 | Tool Management 5テーブル、**25テーブル完成** |
| 土 | Sheetsデータ → PostgreSQL移行スクリプト作成・実行 | 既存データ移行完了 |

**移行対象**:
- Accounts Inventory (`1CmT6C3qCW3md6lJ9Rvc2WNQkWa5zcvlq6Zp_enJHoUE`) → `accounts`
- Characters Inventory → `characters`
- Scenarios / Motions / Audio Inventory → `components`
- Master Spreadsheet production タブ → `content`

#### Week 3 (3/2 - 3/7): MCP Server構築

| 日 | 作業内容 | 成果物 |
|----|---------|--------|
| 月 | MCP Server基盤 (Node.js + TypeScript) セットアップ | プロジェクト初期化、MCP Protocol接続確認 |
| 火 | アカウント管理ツール (6ツール) 実装 | `list_accounts`, `get_account_detail`, etc. |
| 水 | キャラクター管理 (4ツール) + コンポーネント管理 (5ツール) | CRUD + 検索ツール |
| 木 | コンテンツ管理ツール (8ツール) 実装 | `get_pending_tasks`, `update_content_status`, etc. |
| 金 | 投稿管理 (5ツール) + 計測管理 (5ツール) | 投稿記録 + メトリクス保存 |
| 土 | MCP Serverテスト (Jest) + Claude Codeからのツール呼び出しテスト | 基本33ツール動作確認 |

**Phase 1 完了時点のシステム状態**:
```
Docker Compose (dev/prod分離)
┌──────────────────────────────────────────────────┐
│                                                   │
│  PostgreSQL 16+ (pgvector/pgvector:pg16)          │
│  ┌─────────────────────┐   MCP Server (Node.js)  │
│  │ 25テーブル            │   ┌─────────────────┐  │
│  │ Entity 3             │   │ ~33ツール         │  │
│  │ Production 3         │   │ 基本CRUD          │  │
│  │ Intelligence 5       │◄──│ テスト済み         │  │
│  │ Operations 4         │   │                  │  │
│  │ Observability 5      │   └─────────────────┘  │
│  │ Tool Management 5    │                         │
│  │ 全インデックス         │                         │
│  │ 既存データ移行済み     │                         │
│  └─────────────────────┘                         │
└──────────────────────────────────────────────────┘

v4.0パイプライン: 変更なし、Sheets経由で稼働継続
```

### Phase 2: ワーカー層 (Week 4-6)

**目的**: 既存v4.0パイプラインのデータソースをSheets→PostgreSQLに切り替え、DB駆動で動作するワーカーを構築する

**v4.0との関係**: Phase 2完了時にv4.0の`watch-pipeline.js`を停止し、DB駆動パイプラインに完全切替

#### Week 4 (3/9 - 3/14): 制作ワーカー (動画 + テキスト)

| 日 | 作業内容 | 成果物 |
|----|---------|--------|
| 月 | `task_queue`ベースのタスクディスパッチャー実装 | キューポーリング + ワーカー割当 |
| 火 | 動画制作ワーカーの骨格 (LangGraphノードとして定義) | タスク取得 → orchestrator.js呼出 → 結果DB保存 |
| 水 | `inventory-reader.js` → MCP Server への読み取り元切替 | DB起点でシナリオ・キャラ・モーション取得 |
| 木 | `production-manager.js` → PostgreSQL への書き込み先切替。テキスト制作ワーカー開発 (X投稿向けテキストコンテンツ生成) | ステータス更新がDB直接 + X投稿テキスト生成機能 |
| 金 | 制作ワーカー (動画+テキスト) のdry-runテスト。制作ワーカーのDocker化 (production-worker Dockerfile作成) | `--dry-run` でDB→制作→DB保存の一連動作確認 + Dockerイメージ構築 |
| 土 | 制作ワーカーの本番E2Eテスト (fal.ai実行) | 1本の動画 + 1セットのXテキストがDB起点で制作完了 |

**エージェントプロンプト基盤** (Week 4 並行作業):
- `prompts/` ディレクトリ作成、各エージェント種別 (動画制作WK, テキスト制作WK, 投稿WK, 計測WK) のプロンプトファイル (`.md`) を外部化
- `agent_thought_logs` テーブルへのログ書込みインフラ構築 (共通ロガーモジュール)
- `agent_prompt_versions` テーブルへの初期プロンプト登録

#### Week 5 (3/16 - 3/21): 投稿ワーカー

| 日 | 作業内容 | 成果物 |
|----|---------|--------|
| 月 | YouTube Data API v3 投稿アダプター実装 | Shorts動画のアップロード機能 |
| 火 | YouTube OAuth2設定 (最初の1アカウント) | `ACC_xxxx`でOAuth完了、tokens保存 |
| 水 | 投稿ワーカーの骨格 (LangGraphノード) | `ready` → YouTube投稿 → `posted` |
| 木 | 投稿ワーカーのテスト (テスト動画で) | テスト動画をYouTube Shortsに投稿成功 |
| 金 | 投稿スケジューラーロジック (`planned_post_date` + 最適時間帯) | 投稿タイミング計算 |
| 土 | 投稿ワーカー結合テスト | DB → 投稿 → `publications`記録 → `measure_after`設定 |

#### Week 6 (3/23 - 3/28): 計測ワーカー + E2E完了 + MCP ServerのDocker化

| 日 | 作業内容 | 成果物 |
|----|---------|--------|
| 月 | YouTube Analytics APIアダプター実装 | views, likes, comments等の取得 |
| 火 | 計測ワーカーの骨格 (LangGraphノード) | `measure_after`到来 → API取得 → `metrics`保存 |
| 水 | engagement_rate等の計算ロジック実装 (MCP Server内)。MCP Serverにツール関連ツール追加: `get_tool_knowledge`, `save_tool_experience`, `search_similar_tool_usage`, `get_tool_recommendations`, `update_tool_knowledge_from_external` | 計測値の自動集計 + ツール知識管理5ツール |
| 木 | 計測ワーカーのテスト。MCP ServerのDocker化 (mcp-server Dockerfile作成) | Week 5で投稿した動画の計測成功 + MCP Serverコンテナ化 |
| 金 | DB駆動パイプラインのE2Eテスト (Docker環境上) | planned → producing → ready → posted → measured |
| 土 | v4.0 `watch-pipeline.js` 停止、DB駆動パイプラインへ完全切替 | **v4.0からの切替完了** |

**Phase 2 完了時点のシステム状態**:
```
Docker Compose (dev/prod分離)
┌──────────────────────────────────────────────────┐
│  DB駆動パイプライン (稼働中)                        │
│                                                   │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐       │
│  │ 動画制作WK │  │ 投稿WK   │  │ 計測WK   │       │
│  │ (DB→制作  │  │ (DB→投稿  │  │ (DB→計測  │       │
│  │  →DB保存) │  │  →DB保存) │  │  →DB保存) │       │
│  ├──────────┤  └─────┬────┘  └─────┬────┘       │
│  │テキスト   │        │             │              │
│  │制作WK    │        │             │              │
│  │ (X投稿用) │        │             │              │
│  └─────┬────┘        │             │              │
│        │             │             │              │
│        └─────────────┼─────────────┘              │
│                      │                            │
│         MCP Server (~38ツール、含ツール知識管理5)    │
│                      │                            │
│         PostgreSQL (25テーブル、全データ)             │
└──────────────────────────────────────────────────┘

v4.0: watch-pipeline.js 停止済み
      GAS Analytics: まだ稼働中（段階的廃止は Phase 3以降）
YouTube: 1プラットフォーム稼働
Docker: PostgreSQL + MCP Server + 制作WK がコンテナ化済み
```

### Phase 3: インテリジェンス層 (Week 7-10)

**目的**: AIエージェントが自律的に市場調査・分析・学習するインテリジェンス機能を構築する

**人間チューニング方針**: Phase 3はエージェントの「知性」が形成される最重要フェーズ。各LangGraphノードにthought logging（思考過程の記録）を組み込み、`prompts/*.md` からプロンプトを動的に読み込む仕組みを導入する。日次〜週次でプロンプトチューニングを実施し、エージェントの推論品質を継続的に改善する運用が期待される。また、ツールスペシャリストAgentにより、AIツール (fal.ai Kling, Fish Audio等) の使い方知識を自動学習・更新し、制作フローをエージェント駆動の動的レシピ選択に切り替える。プロンプト自動提案メカニズムにより、score低下時の改善提案が `prompt_suggestions` テーブルに自動生成される。

#### Week 7 (3/30 - 4/4): LangGraph.js + リサーチャー基盤 + ツールスペシャリスト

| 日 | 作業内容 | 成果物 |
|----|---------|--------|
| 月 | LangGraph.js v1.0 セットアップ + TypeScript設定。LangGraphエージェントのDocker化 (agent Dockerfile作成) | プロジェクト統合、基本グラフ実行確認、Dockerイメージ構築 |
| 火 | `langchain-mcp-adapters` による MCP Server接続 + プロンプトローダー実装 | LangGraphノードからMCPツール呼び出し成功、`prompts/*.md` からの動的読み込み |
| 水 | チェックポイント設定 + thought logging共通ミドルウェア実装 | 耐久実行の基盤 + 全ノードの思考過程を `agent_thought_logs` に自動記録 |
| 木 | リサーチャーエージェントの骨格 (LangGraphグラフ) + リサーチャー用 `prompts/researcher.md` 作成 | ノード定義 + ステート管理 + 外部プロンプト |
| 金 | ツールスペシャリストAgent開発: LangGraphグラフにツールスペシャリストノードを追加 + `prompts/tool-specialist.md` 作成 | ツールスペシャリストノード + 専用プロンプト |
| 土 | WebSearch統合 (トレンドデータ収集) + リサーチャーの動作テスト | `market_intel`テーブルにデータ蓄積開始 |

#### Week 8 (4/6 - 4/11): リサーチャー完成 + MCP追加ツール + ツール知識学習サイクル

| 日 | 作業内容 | 成果物 |
|----|---------|--------|
| 月 | 競合データ収集機能の実装 | 競合アカウント・投稿のデータ取得 |
| 火 | MCP仮説管理ツール (6ツール) 実装 | `create_hypothesis`, `search_similar_hypotheses`, etc. |
| 水 | MCP知見管理ツール (4ツール) 実装 | `save_insight`, `search_similar_insights`, etc. |
| 木 | MCP分析管理ツール (5ツール) + ツール知識学習サイクル実装 (外部情報源スキャン → 知識抽出 → `tool_catalog` 更新) | `get_performance_summary`, `get_trending_topics`, etc. + ツール知識の自動更新 |
| 金 | MCP戦略管理ツール (4ツール) + 設定管理ツール (3ツール)。制作フローのエージェント駆動化 (固定パイプライン → ツールスペシャリスト推奨レシピに基づく動的フロー) | `review_plan`, `approve_plan`, etc. + 動的制作レシピ選択 |
| 土 | 全MCPツールのテスト (~65ツール完成) | 全ツール動作確認 (含: ツール知識管理5ツール) |

#### Week 9 (4/13 - 4/18): アナリストエージェント + プロンプト自動提案

| 日 | 作業内容 | 成果物 |
|----|---------|--------|
| 月 | アナリストエージェントの骨格 (LangGraphグラフ) + `prompts/analyst.md` 作成 | ノード定義 + ステート管理 + 外部プロンプト + thought logging統合 |
| 火 | 仮説検証ロジック (`predicted_kpis` vs `actual_kpis`) | 仮説のverdict判定ロジック |
| 水 | 知見抽出ロジック (confirmed仮説 → learnings昇格) | 自動的な知見蓄積 |
| 木 | サイクルレビュー生成 (`analyses` テーブルへの書込み) | `cycle_review` 分析の自動生成 |
| 金 | 異常検知ロジック (views急落・急増の自動検出)。プロンプト自動提案メカニズム実装 (score低下検知 → `agent_thought_logs` 分析 → 改善提案を `prompt_suggestions` に生成) | `anomaly_detection` 分析 + プロンプト改善提案の自動生成 |
| 土 | アナリストの結合テスト + ツールスペシャリストの結合テスト | メトリクス → 分析 → 知見の一連動作確認 + ツール知識学習サイクルの動作確認 |

#### Week 10 (4/20 - 4/25): Embedding + pgvector検索 + データキュレーター

| 日 | 作業内容 | 成果物 |
|----|---------|--------|
| 月 | Embeddingモデル統合 (text-embedding-3-small or Voyage-3) | テキスト → vector(1536) 変換パイプライン |
| 火 | 仮説のembedding自動生成 + HNSW検索テスト | 類似仮説の自動検索 |
| 水 | 知見のembedding + 市場情報のembedding。データキュレーターAgent開発: `prompts/data-curator.md` 作成 + MCPキュレーションツール6種実装 (`get_curation_queue`, `create_component`, `update_component_data`, `mark_curation_complete`, `get_similar_components`, `submit_for_human_review`) | 3テーブルのベクトル検索対応完了 + データキュレーター基盤 |
| 木 | 重複仮説防止ロジック (コサイン類似度閾値)。データキュレーターの重複検出 (pgvector類似コンポーネント検索) + 品質スコア初期設定ロジック | 類似度0.9以上の仮説を自動マージ + コンポーネント重複防止 |
| 金 | `algorithm_performance` テーブルへの自動記録。データキュレーターとリサーチャーの連携テスト (market_intel → curate queue → components) | 仮説的中率・予測誤差の追跡開始 + キュレーション自動パイプライン |
| 土 | インテリジェンス層の結合テスト | リサーチャー → データキュレーター → アナリスト → 知見蓄積のE2E |

**Phase 3 完了時点のシステム状態**:
```
Docker Compose (全コンポーネントコンテナ化)
┌─────────────────────────────────────────────────────────────────┐
│  インテリジェンス層 (稼働中)                                        │
│                                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌────────────────────┐    │
│  │ リサーチャー    │  │ アナリスト     │  │ ツールスペシャリスト  │    │
│  │ (Sonnet)      │  │ (Sonnet)      │  │ (Sonnet)           │    │
│  │ ・市場調査      │  │ ・仮説検証     │  │ ・ツール知識管理      │    │
│  │ ・トレンド収集   │  │ ・知見抽出     │  │ ・外部情報源スキャン   │    │
│  │ ・競合分析      │  │ ・異常検知     │  │ ・制作レシピ推奨      │    │
│  │               │  │ ・プロンプト    │  │ ・動的フロー制御      │    │
│  │               │  │  自動提案      │  │                    │    │
│  └───────┬───────┘  └───────┬───────┘  └─────────┬──────────┘    │
│          │                  │                     │               │
│  ┌───────┴────────────────┐ │                     │               │
│  │ データキュレーター       │ │                     │               │
│  │ (Sonnet)               │ │                     │               │
│  │ ・生データの構造化      │ │                     │               │
│  │ ・コンポーネント自動生成 │ │                     │               │
│  │ ・重複チェック・品質判定 │ │                     │               │
│  └───────┬────────────────┘ │                     │               │
│          │                  │                     │               │
│          └──────────────────┼─────────────────────┘               │
│                             │                                     │
│  DB駆動パイプライン + MCP Server (~74ツール)                        │
│  + pgvectorベクトル検索 + Embedding自動生成                         │
│                             │                                     │
│               PostgreSQL (知見蓄積中、ツール知識学習中、             │
│                コンポーネント自動生成中)                             │
└─────────────────────────────────────────────────────────────────┘

→ AIが自律的にデータを分析し、知見を蓄積し始める
→ ツールスペシャリストがAIツールの知識を自動学習・更新
→ データキュレーターがリサーチャーの市場データからコンポーネントを自動生成
→ プロンプト改善提案が自動生成される
→ GAS Analyticsの機能はアナリストが代替開始
```

### Phase 4: 戦略・計画層 (Week 11-14)

**目的**: 戦略Agent + プランナーによる全自動サイクルを構築し、コンテンツ企画→制作→投稿→計測→分析→学習が回るようにする

**人間承認フロー (Phase 4初期)**: Phase 4では `REQUIRE_HUMAN_APPROVAL = true` をデフォルトとする。プランナーが生成したコンテンツ計画は、LangGraph interruptで一時停止し、ダッシュボード上の承認パネルで人間がレビュー・承認してから制作を開始する。これにより、AIの計画品質を人間が確認しながらサイクルの信頼性を段階的に構築する

**人間チューニング運用の正式化**: Phase 4では、Phase 3で蓄積されたthought logを基に人間チューニングワークフローを正式化する。定期的なプロンプト改善サイクル（thought log確認 → プロンプト修正 → `agent_prompt_versions` に版管理 → 効果計測）を確立し、`algorithm_performance` テーブルでエージェント進化の追跡を開始する。

#### Week 11 (4/27 - 5/2): 戦略エージェント

| 日 | 作業内容 | 成果物 |
|----|---------|--------|
| 月 | 戦略サイクルグラフの定義 (LangGraph Supervisorパターン) | グラフ構造 + ステート型定義 |
| 火 | 戦略Agent (Opus) のプロンプト設計 (`prompts/strategist.md`) + ノード実装 + thought logging統合 | KPI監視 + 方針決定ロジック + 思考過程記録 |
| 水 | `human_directives` 読み取り + 計画への反映ロジック | 人間の指示を自動取り込み |
| 木 | 計画承認/差戻しフロー (approve_plan / reject_plan)。`REQUIRE_HUMAN_APPROVAL = true` をデフォルト設定。LangGraph interruptによる人間承認フロー統合 | Supervisorパターンの承認ループ + 人間承認ゲート |
| 金 | 戦略Agentのテスト (モック市場データで) | 方針決定 → 計画指示の一連動作 |
| 土 | `cycles` テーブルとの連携テスト | サイクル管理の自動化 |

#### Week 12 (5/4 - 5/9): プランナーエージェント

| 日 | 作業内容 | 成果物 |
|----|---------|--------|
| 月 | プランナーエージェントの骨格 (`prompts/planner.md`) + thought logging統合 | アカウント × シナリオのマッチング + 思考過程記録 |
| 火 | コンテンツ計画作成ロジック | 仮説に基づくコンテンツ企画 |
| 水 | `planned_post_date` 自動設定 + スケジュール最適化 | 投稿日の自動算出 |
| 木 | 知見の自動適用 (learningsテーブル参照) | 過去の学びを計画に反映 |
| 金 | 戦略Agent → プランナー → 制作ワーカーの接続テスト | 仮説駆動サイクルの一気通貫 |
| 土 | 仮説駆動サイクルのE2Eテスト (1サイクル分) | 戦略→計画→制作→投稿→計測→分析→学習 |

**人間チューニングワークフロー** (Week 12 並行作業):
- thought logの定期レビュー手順書の策定（日次: 異常検知ログ確認、週次: プロンプト改善レビュー）
- `agent_prompt_versions` によるプロンプト版管理運用の開始（変更前後の差分追跡）
- エージェント進化追跡の初期データ収集開始（`algorithm_performance` テーブルに精度推移を記録）

#### Week 13 (5/11 - 5/16): 全自動サイクル + 追加プラットフォーム (1)

| 日 | 作業内容 | 成果物 |
|----|---------|--------|
| 月 | サイクル自動実行の仕組み (日次トリガー) | PM2 + cron による自動起動 |
| 火 | TikTok Content Posting API アダプター実装 | TikTok投稿機能 |
| 水 | TikTok API 計測アダプター実装 | TikTokメトリクス取得 |
| 木 | Instagram Graph API アダプター実装 | Instagram Reels投稿 |
| 金 | Instagram Insights API 計測アダプター実装 | Instagramメトリクス取得 |
| 土 | 3プラットフォーム (YouTube + TikTok + Instagram) の結合テスト | マルチプラットフォーム投稿確認 |

#### Week 14 (5/18 - 5/23): 追加プラットフォーム (2) + サイクル安定化

| 日 | 作業内容 | 成果物 |
|----|---------|--------|
| 月 | X API v2 投稿アダプター実装 | X投稿機能 (動画付きポスト) |
| 火 | X API v2 計測アダプター実装 | Xメトリクス取得 |
| 水 | 全4プラットフォームの結合テスト | YouTube + TikTok + Instagram + X |
| 木 | プランナー増設テスト (2クラスター並列) | 水平スケールの検証 |
| 金 | エラーハンドリング強化 (リトライ, フォールバック, アラート) | 障害復旧の自動化 |
| 土 | 全自動サイクルの72時間連続稼働テスト | 3日間の無人運用で安定性確認 |

**Phase 4 完了時点のシステム状態**:
```
Docker Compose (全コンポーネントコンテナ化)
┌──────────────────────────────────────────────────────────────────┐
│  全自動仮説駆動サイクル (稼働中)                                     │
│                                                                   │
│  ┌──────────┐                                                     │
│  │ 戦略Agent │ (Opus) — 日次サイクル管理                            │
│  └─────┬────┘                                                     │
│        │ 方針指示                                                  │
│  ┌─────┼──────────────────────────────────────────────┐          │
│  │     ▼          ▲          ▲          ▲             │          │
│  │ ┌────────┐ ┌────────┐ ┌────────┐ ┌──────────────┐ │          │
│  │ │プランナー│ │リサーチャー│ │アナリスト│ │ツールスペシャ │ │          │
│  │ │(Sonnet)│ │(Sonnet)│ │(Sonnet)│ │リスト(Sonnet)│ │          │
│  │ └───┬────┘ └────────┘ └────────┘ └──────────────┘ │          │
│  │     │ 制作指示                                      │          │
│  │ ┌───┼──────────────────────────────────────────┐   │          │
│  │ │   ▼           ▼           ▼          ▼       │   │          │
│  │ │ 動画制作WK  テキスト    投稿WK     計測WK     │   │          │
│  │ │ (fal.ai)  制作WK(X用) (4PF)     (4 API)    │   │          │
│  │ └─────────────────────────────────────────────┘   │          │
│  └────────────────────────────────────────────────────┘          │
│                          │                                        │
│                  MCP Server (~65ツール)                            │
│                          │                                        │
│                PostgreSQL + pgvector                               │
│                (仮説駆動サイクル + ツール知識学習が回っている)          │
└──────────────────────────────────────────────────────────────────┘

→ コンテンツ企画→[人間承認]→制作→投稿→計測→分析→学習
→ REQUIRE_HUMAN_APPROVAL = true (人間がダッシュボード上で計画を承認してから制作開始)
→ 4プラットフォーム対応 (YouTube, TikTok, Instagram, X)
→ ツールスペシャリストが制作レシピを動的に推奨
```

### Phase 5: ダッシュボード + スケール (Week 15-19)

**目的**: 人間の監視・介入UIを構築し、3,500アカウントまでスケールさせて本番運用を開始する

**技術方針**:
- ダッシュボードのデータ取得: React Query (TanStack Query) + 30秒 refetch interval。staleTime: 15秒
- 初期はデスクトップ専用。Phase 5以降でレスポンシブ対応を検討

#### Week 15 (5/25 - 5/30): ダッシュボード基盤 + Docker化

| 日 | 作業内容 | 成果物 |
|----|---------|--------|
| 月 | Next.js + Shadcn/ui プロジェクト初期化。Next.jsダッシュボードのDocker化 (dashboard Dockerfile作成) | ダッシュボード基盤 + Dockerイメージ構築 |
| 火 | ORM設定 (Prisma or Drizzle) + PostgreSQL接続 | 型安全なDB接続 |
| 水 | KPI進捗ページ (目標vs実績、アカウント別、日次/週次) | グラフ描画 (Recharts) |
| 木 | アルゴリズム精度推移ページ (仮説的中率、学習曲線) + エージェント進化グラフ (時系列の学習精度・推論品質推移) | 精度トレンド + エージェント進化の可視化 |
| 金 | 投稿別パフォーマンスページ (views, engagement, 比較) | 個別投稿の詳細分析UI |
| 土 | ダッシュボード読み取り機能の結合テスト | 全3ページの動作確認 |

#### Week 16 (6/1 - 6/6): 人間介入パネル + ツール管理画面 + 追加ページ

| 日 | 作業内容 | 成果物 |
|----|---------|--------|
| 月 | 人間介入パネル: 仮説投入フォーム + プロンプトエディタUI (`prompts/*.md` のブラウザ上編集・保存・版管理) | `human_directives` 書込み + プロンプトのダッシュボード編集 |
| 火 | 人間介入パネル: コンテンツ計画承認パネル (プランナー生成計画の一覧表示・承認・差戻し・一括承認UI) + 参考コンテンツ指定 + 設定変更 (REQUIRE_HUMAN_APPROVAL: settingsテーブルで管理、トグルUI。エージェントはget_system_settings() MCPツールで毎サイクル読み取り。Phase 4からfalseに移行) + 人間-エージェント対話インターフェース (1対1のフィードバック送受信)。推奨プロンプト改善パネル (`prompt_suggestions` テーブルの表示・承認・却下UI) | 承認パネル + 投稿頻度変更UI + エージェントへの直接フィードバック + プロンプト改善提案の管理 |
| 水 | 学習ログページ (知見一覧、仮説→結果、改善提案) + thought logビューア (`agent_thought_logs` の検索・フィルタ・時系列表示) | 知見の可視化 + エージェント思考過程の閲覧 |
| 木 | ツールスペシャリスト管理画面: `tool_catalog` 閲覧・編集、`tool_experiences` 統計表示、制作レシピ一覧。キュレーション結果レビューパネル: `review_status='pending_review'` コンポーネント一覧・承認/修正/削除UI・参考コンテンツ提出フォーム。エージェント実行ログページ (タスク状況、エラー率) + エージェント進化ダッシュボード (プロンプト版ごとの精度比較) | ツール知識管理UI + キュレーションレビューUI + 運用監視UI + プロンプト改善効果の可視化 |
| 金 | 認証・アクセス制御の実装: NextAuth.js + Google OAuth認証。初期は単一管理者ユーザー。Phase 5以降でRBAC拡張を検討 | ログイン機能 |
| 土 | ダッシュボード全機能の結合テスト | 全ページ + 書込み機能の動作確認 |

#### Week 17 (6/8 - 6/13): ダッシュボード追加ページ + スケール対応 (1)

| 日 | 作業内容 | 成果物 |
|----|---------|--------|
| 月 | エージェント個別成長トラッキングページ (パフォーマンスカード、成長比較、個別学習ブラウザ) | エージェント別成長可視化UI |
| 火 | エージェント受信トレイページ (メッセージ一覧、返信フロー、週次ダイジェスト) | エージェント通知管理UI |
| 水 | プランナー増設 (3-5クラスター) + タスクキューの並列処理最適化 | ニッチ別のプランナー並列稼働 + 複数ワーカーの同時実行 |
| 木 | PostgreSQLクエリ最適化 (EXPLAIN ANALYZE) + コネクションプール調整 (pgBouncer検討) | スロークエリの解消 + DB接続の安定化 |
| 金 | 負荷テスト (500アカウント相当のシミュレーション) | ボトルネック特定 |
| 土 | 負荷テスト結果に基づく改善 | スループット改善 |

#### Week 18 (6/15 - 6/20): スケール対応 (2) + Docker完全移行 + 安定化

| 日 | 作業内容 | 成果物 |
|----|---------|--------|
| 月 | プランナー増設 (10-15クラスター、各200-350アカウント担当) | 3,500アカウント対応のプランナー群 |
| 火 | fal.aiクレジット管理の自動化 (残高監視 + アラート)。知見移植プロセスの確立 (手動Claude知見 → MDファイル化 → エージェントプロンプトへの反映手順の文書化・自動化) | コスト管理 + 知見移植プロセス文書化 |
| 水 | v4.0パイプラインのDocker化: PM2完全廃止、全プロセスをdocker-compose管理に移行。アカウント一括登録スクリプト | PM2→Docker完全移行 + 大量アカウントのセットアップ |
| 木 | 全プラットフォームのOAuth一括設定ツール。開発/本番環境の完全分離: `docker-compose.prod.yml` による本番デプロイフローの確立 | アカウント設定の自動化 + 本番デプロイフロー完成 |
| 金 | 1,000アカウント規模の負荷テスト (Docker環境上)。`REQUIRE_HUMAN_APPROVAL = false` への段階的移行: 承認パターンの自動学習 (過去の承認/差戻し履歴の分析)、ジャンル別・コスト別の自動承認ルール設定、高コスト案件の人間承認維持オプション | 大規模運用の安定性確認 + 自動承認移行の基盤 |
| 土 | 監視・アラートの設定 (Docker healthcheck + ログ監視) | 障害検知体制 |

#### Week 19 (6/22 - 6/27): 本番運用開始

| 日 | 作業内容 | 成果物 |
|----|---------|--------|
| 月 | 本番アカウント登録 (3,500アカウント) | 全アカウントDB登録 |
| 火 | 段階的稼働開始 (最初の500アカウントで本番サイクル開始) | 本番運用開始 |
| 水 | 1,500アカウントに拡大 | スケールアップ |
| 木 | 3,500アカウントに拡大 | フルスケール稼働 |
| 金 | 72時間連続稼働モニタリング + 異常対応 | 安定運用確認 |
| 土 | GASコード・Sheetsの完全停止 + ドキュメント更新。全Docker Composeの最終確認 | **v5.0本番運用完了 (全プロセスDocker管理)** |

## 4. マイルストーン

| ID | マイルストーン | 予定日 | 判定基準 | KPI対応 |
|----|-------------|--------|---------|---------|
| M1 | DB稼働 | 3/7 (W3土) | Docker環境上でPostgreSQL 25テーブル + MCP Server ~33ツールが動作。既存データ移行完了 | 50アカウント管理可能 |
| M2 | DB駆動パイプライン完成 | 3/28 (W6土) | DB起点で planned→producing→ready→posted→measured の全ステータス遷移が動作。MCP Server ~38ツール (含ツール知識管理5) + Docker化完了 | 160アカウントのDB管理開始 |
| M3 | AI学習開始 | 4/25 (W10土) | リサーチャー + アナリスト + ツールスペシャリスト + データキュレーターが稼働。仮説生成 → 検証 → 知見蓄積 + ツール知識学習 + コンポーネント自動生成 + プロンプト自動提案が自動で回る | 340アカウントの分析開始 |
| M4 | 全自動サイクル | 5/23 (W14土) | 戦略Agent → プランナー → ワーカーの完全自律サイクル。人間承認フロー (`REQUIRE_HUMAN_APPROVAL = true`) 稼働。4プラットフォーム対応 | 1,480アカウントの自動運用 |
| M5 | 本番運用開始 | 6/27 (W19土) | ダッシュボード稼働。3,500アカウントのフルスケール運用 | 3,500アカウント完全稼働 |

### マイルストーン判定チェックリスト

**M1: DB稼働**
- [ ] Docker環境構築完了 (`docker-compose.yml` + `docker-compose.dev.yml` + `docker-compose.prod.yml`)
- [ ] PostgreSQL 16+ が `pgvector/pgvector:pg16` Dockerコンテナ上で稼働
- [ ] pgvector拡張が有効
- [ ] 25テーブル全て作成済み (Entity 3 + Production 3 + Intelligence 5 + Operations 4 + Observability 5 + Tool Management 5)
- [ ] Tool Management テーブル作成済み (`tool_catalog`, `tool_experiences`, `tool_external_sources`, `production_recipes`, `prompt_suggestions`)
- [ ] 全インデックス作成済み
- [ ] `updated_at`トリガー動作確認
- [ ] 開発/本番環境の分離設計完了 (`.env.dev` / `.env.prod`)
- [ ] 既存Sheetsデータの移行完了
- [ ] MCP Server ~33ツール動作確認
- [ ] Claude Codeからのツール呼び出しテスト成功

**M2: DB駆動パイプライン完成**
- [ ] 動画制作ワーカーがDB起点で動画生成完了
- [ ] テキスト制作ワーカーがDB起点でX投稿テキスト生成完了
- [ ] 投稿ワーカーがYouTubeに投稿完了
- [ ] 計測ワーカーがYouTube Analyticsからメトリクス取得完了
- [ ] 全ステータス遷移がDB上で正常動作
- [ ] v4.0 `watch-pipeline.js` の停止完了
- [ ] 24時間の無人稼働テスト成功
- [ ] `prompts/` ディレクトリにワーカー用プロンプトファイル配置済み (動画制作WK + テキスト制作WK + 投稿WK + 計測WK)
- [ ] thought logging共通ロガーが動作し `agent_thought_logs` に記録
- [ ] MCP Serverにツール知識管理ツール5種追加済み (`get_tool_knowledge`, `save_tool_experience`, `search_similar_tool_usage`, `get_tool_recommendations`, `update_tool_knowledge_from_external`)
- [ ] 制作ワーカー Dockerfile 構築・動作確認済み
- [ ] MCP Server Dockerfile 構築・動作確認済み

**M3: AI学習開始**
- [ ] LangGraph.jsグラフが正常実行 (Docker環境上)
- [ ] LangGraphエージェント Dockerfile 構築・動作確認済み
- [ ] リサーチャーが`market_intel`にデータ蓄積
- [ ] アナリストが仮説を検証し`verdict`を判定
- [ ] ツールスペシャリストAgentが稼働し`tool_catalog`を更新
- [ ] `prompts/tool-specialist.md` が作成され動的に読み込まれている
- [ ] ツール知識学習サイクルが動作 (外部情報源スキャン → 知識抽出 → `tool_catalog` 更新)
- [ ] 制作フローがエージェント駆動化 (ツールスペシャリスト推奨レシピに基づく動的フロー)
- [ ] データキュレーターAgentが稼働しリサーチャーの市場データから`components`を自動生成
- [ ] `prompts/data-curator.md` が作成され動的に読み込まれている
- [ ] データキュレーターMCPツール6種が動作 (`get_curation_queue`, `create_component`, etc.)
- [ ] 重複コンポーネント検出 (pgvector類似検索) が動作
- [ ] プロンプト自動提案メカニズムが動作 (score低下検知 → `prompt_suggestions` に改善提案生成)
- [ ] 知見が`learnings`テーブルに蓄積
- [ ] pgvectorベクトル検索が動作
- [ ] `algorithm_performance`に精度データが記録
- [ ] 全LangGraphノードでthought loggingが稼働し思考過程が記録されている
- [ ] `prompts/*.md` からの動的プロンプト読み込みが全エージェントで動作

**M4: 全自動サイクル**
- [ ] 戦略Agent (Opus) が日次でサイクル実行
- [ ] プランナーがコンテンツ計画を自動策定
- [ ] ツールスペシャリストが制作レシピを動的に推奨
- [ ] テキスト制作ワーカーがX投稿テキストを自動生成
- [ ] 4プラットフォーム (YouTube, TikTok, Instagram, X) への投稿成功
- [ ] 仮説駆動サイクルが3日間連続で自律稼働
- [ ] `REQUIRE_HUMAN_APPROVAL = true` がデフォルトで動作し、LangGraph interruptで計画承認を待機
- [ ] 人間承認後にサイクルが正常に再開される
- [ ] 人間チューニングワークフロー (thought log確認 → プロンプト修正 → 効果計測) が運用開始
- [ ] `agent_prompt_versions` でプロンプトの版管理が機能している

**M5: 本番運用開始**
- [ ] Next.jsダッシュボードが稼働 (Docker化済み)
- [ ] 人間介入パネルが動作
- [ ] コンテンツ計画承認パネルが動作 (計画一覧表示・承認・差戻し・一括承認)
- [ ] `REQUIRE_HUMAN_APPROVAL = false` への段階的移行が可能 (承認パターン自動学習 + 高コスト案件の人間承認維持オプション)
- [ ] 推奨プロンプト改善パネルが動作 (`prompt_suggestions` の表示・承認・却下)
- [ ] ツールスペシャリスト管理画面が動作 (`tool_catalog` 閲覧・編集、`tool_experiences` 統計表示)
- [ ] 3,500アカウントがDB登録済み
- [ ] 3,500アカウント規模で72時間安定稼働
- [ ] プロンプトエディタUIが動作 (ダッシュボードから `prompts/*.md` を編集・保存可能)
- [ ] thought logビューアが動作 (エージェント思考過程の検索・閲覧可能)
- [ ] エージェント進化グラフが表示 (プロンプト版ごとの精度比較可能)
- [ ] 人間-エージェント対話インターフェースが動作 (1対1フィードバック送受信可能)
- [ ] 知見移植プロセスが確立 (手動Claude知見 → MDファイル化 → エージェントプロンプト反映の手順文書化・自動化)
- [ ] 全プロセスがdocker-compose管理下 (PM2完全廃止)
- [ ] 開発/本番環境の完全分離 (`docker-compose.prod.yml` による本番デプロイフロー確立)
- [ ] GAS / Sheets完全停止

## 5. 依存関係

### 5.1 フェーズ間の依存

```
Phase 1: データ基盤
    │
    │ PostgreSQL + MCP Server が前提
    │
    ▼
Phase 2: ワーカー層
    │
    │ DB駆動パイプラインが前提
    │
    ▼
Phase 3: インテリジェンス層
    │
    │ LangGraph + リサーチャー + アナリストが前提
    │
    ▼
Phase 4: 戦略・計画層
    │
    │ 全自動サイクルが前提
    │
    ▼
Phase 5: ダッシュボード + スケール
```

**クリティカルパス**: Phase 1 → Phase 2 → Phase 3 → Phase 4 → Phase 5
全フェーズが直列依存。各フェーズの遅延は全体スケジュールに直接影響する。

### 5.2 フェーズ内の依存

```
Phase 1内:
  Docker環境構築 → PostgreSQL設定 → スキーマ作成 (25テーブル) → データ移行 → MCP Server
  (W1月)           (W1)            (W2)                       (W2土)       (W3)

Phase 2内:
  タスクディスパッチャー → 動画制作WK+テキスト制作WK → 投稿WK → 計測WK+ツールMCPツール+Docker化
  (W4月)                 (W4)                       (W5)     (W6)

Phase 3内:
  LangGraph設定+Docker化 → リサーチャー+ツールスペシャリスト → アナリスト+プロンプト自動提案 → Embedding
  (W7月-火)                (W7-8)                           (W9)                            (W10)

Phase 4内:
  戦略Agent → プランナー → サイクル接続 → マルチPF
  (W11)      (W12)        (W13月)       (W13火-W14)

Phase 5内:
  ダッシュボード+Docker化 → 介入パネル+ツール管理画面 → スケール+Docker完全移行 → 本番
  (W15)                   (W16)                      (W17-18)                   (W19)
```

### 5.3 外部依存

| 依存先 | 必要な時期 | リードタイム | 対策 |
|--------|-----------|-------------|------|
| YouTube OAuth | Week 5 (投稿WK) | 1-2日 | Phase 1から申請開始 |
| TikTok Content Posting API | Week 13 | 2-4週間 | Phase 1から審査申請 |
| Instagram Graph API | Week 13 | 1-2週間 | Metaビジネスアカウント事前取得 |
| X API v2 Premium | Week 14 | 即日 (有料プラン) | $8/月/アカウントのコスト承認 |
| fal.aiクレジット | 全期間 | 即日 | 月次でクレジット確認 |
| Embeddingモデル (OpenAI/Anthropic) | Week 10 | 即日 (APIキー取得) | Phase 3開始前にAPIキー確保 |
| GCE VM (既存) | 全期間 | - | 既存リソース利用、スペック不足時はアップグレード |

## 6. 並行運用計画

### 6.1 v4.0 → v5.0 の切替タイムライン

```
                    Phase 1          Phase 2          Phase 3-5
                    (W1-3)           (W4-6)           (W7-19)
                    ──────           ──────           ────────

v4.0 パイプライン   ██████████████   ████████████
(watch-pipeline)    稼働中            稼働中 → W6停止

v4.0 GAS Analytics  ██████████████   ████████████████   ████████
                    稼働中            稼働中              段階廃止 → 停止

PM2 → Docker移行    PM2稼働中         PM2稼働中           PM2稼働 → W18でDocker完全移行

v5.0 Docker環境     ── 構築(W1) ───   コンテナ追加        全コンポーネントDocker化
v5.0 DB + MCP      ── 構築中 ──────   稼働開始          稼働中
v5.0 ワーカー                         ── 構築中 ──────   稼働中
v5.0 エージェント                                        構築中 → 稼働中
v5.0 ダッシュボード                                                 構築中→稼働
```

### 6.2 切替ルール

| 対象 | 切替タイミング | 切替条件 | ロールバック方法 |
|------|-------------|---------|---------------|
| watch-pipeline.js | Week 6 土曜 | DB駆動パイプラインのE2E成功 | PM2で再起動 (設定ファイル保持) |
| Sheets書込み | Week 6 以降段階的 | PostgreSQLが正のソース | 逆同期スクリプトでSheetsに書戻し |
| GAS Analytics | Week 9-10 (段階的) | アナリストAgentが同等機能を提供 | GASコードは削除せず無効化のみ |
| Sheets UI (PipelineUI.gs) | Week 12 以降 | 戦略Agent + プランナーが代替 | GAS UI再有効化 |
| PM2 → Docker | Week 18 | 全プロセスのDockerfile完成 + docker-compose動作確認 | PM2設定ファイルは保持、`pm2 resurrect` で復旧可能 |
| Google Sheets全体 | Week 19 | 全機能がDB + ダッシュボードに移行完了 | Sheetsデータは削除せずアーカイブ |

### 6.3 並行運用期間のデータ整合性

Phase 2完了 (Week 6) まではSheetsとPostgreSQLの両方にデータが存在する。整合性を確保するために以下のルールを適用する。

1. **Phase 1-2 (W1-W6)**: Sheetsが正のソース。PostgreSQLはSheets→DB方向の一方向同期
2. **Phase 2完了後 (W6〜)**: PostgreSQLが正のソース。Sheetsへの書込みを停止
3. **ロールバック用**: PostgreSQL→Sheets方向の逆同期スクリプトをPhase 1で用意しておく

## 7. リスクバッファ

各フェーズに1週間のバッファを確保する。バッファ消化が発生しない場合は、次フェーズの先行作業またはテスト強化に充当する。

### 7.1 フェーズ別リスクと対策

| Phase | 主要リスク | 発生確率 | 影響度 | バッファ消化の判断基準 | 対策 |
|-------|----------|---------|--------|---------------------|------|
| 1 | Docker環境構築トラブル、pgvectorの構築トラブル、データ移行の型変換エラー | 中 | 中 | Week 3の作業がWeek 4にずれ込む場合 | `pgvector/pgvector:pg16` 公式Dockerイメージ使用で構築リスク軽減。dev/prod分離は最小限から開始 |
| 2 | YouTube OAuth審査の遅延、fal.aiのAPI変更 | 中 | 高 | 投稿ワーカーがWeek 6までに完成しない場合 | YouTube OAuthをPhase 1から事前申請。fal.ai APIは既存v4.0コードを最大限再利用 |
| 3 | LangGraphの学習コスト、MCPアダプターの互換性問題 | 高 | 高 | LangGraph統合がWeek 8までに完成しない場合 | LangGraphの公式サンプルを先にフォーク。最悪はMCPなしで直接ツール呼出し |
| 4 | Supervisorパターンの安定性、マルチPF API審査遅延 | 中 | 高 | 全自動サイクルがWeek 14までに安定しない場合 | YouTube単独でまず安定化。他PFは順次追加 |
| 5 | 3,500アカウント規模での性能問題 | 高 | 中 | 負荷テストで目標スループットに未達 | Cloud SQLインスタンスのスケールアップ、クエリ最適化、接続プーリング調整 |

### 7.2 バッファの運用方針

```
通常スケジュール:  Phase 1 (3週) → Phase 2 (3週) → Phase 3 (4週) → Phase 4 (4週) → Phase 5 (5週)
                  = 19週 (2/16 → 6/27)

最悪スケジュール:  +1週      +1週      +1週       +1週       +1週
                  = 24週 (2/16 → 7/25)

バッファ消費パターン:
  パターンA: 各フェーズで0.5週ずつ遅延 → 全体で2.5週遅延 → 7/4完了 (許容範囲)
  パターンB: Phase 3で1週遅延 → 以降は予定通り → 7/4完了 (許容範囲)
  パターンC: Phase 2, 3で各1週遅延 → 7/11完了 (KPI 6月目標に影響)
```

**判断ポイント**: Week 10 (Phase 3完了予定) 時点で全体スケジュールを再評価する。2週以上の遅延が見込まれる場合、Phase 5の一部機能 (ダッシュボードの一部ページ) をスコープアウトして対応する。

## 8. KPIとの整合性

### 8.1 フェーズ完了とKPI目標の対応

```
                          アカウント数
                     3,500 ┤                                              ╔════
                           │                                         ╔════╝
                           │                                    ╔════╝
                     1,480 ┤                               ╔════╝
                           │                          ╔════╝
                           │                     ╔════╝
                       340 ┤                ╔════╝
                           │           ╔════╝
                       160 ┤      ╔════╝
                           │ ╔════╝
                        50 ┤═╝
                           │
                           └──────┬──────┬──────┬──────┬──────┬──────
                                  2月    3月    4月    5月    6月

Phase完了タイミング:        P1(M1)  P2(M2)  P3(M3)  P4(M4)  P5(M5)
```

| 月 | KPI目標 | Phase状態 | 実現方法 |
|----|---------|----------|---------|
| 2月末 | 50アカウント | Phase 1 完了 (DB + MCP) | v4.0パイプラインで稼働中の50アカウントをDB管理下に移行 |
| 3月末 | 160アカウント | Phase 2 完了 (DB駆動PL) | DB駆動パイプラインで160アカウントの制作・投稿を自動化 |
| 4月末 | 340アカウント | Phase 3 完了 (AI学習) | AIが市場分析・仮説検証を開始。340アカウントの知的運用 |
| 5月末 | 1,480アカウント | Phase 4 完了 (全自動) | 全自動サイクル + 4PF対応。プランナー増設で1,480アカウント |
| 6月末 | 3,500アカウント | Phase 5 完了 (本番) | フルスケール運用。ダッシュボードで監視 |

### 8.2 KPI達成に必要な制作能力

| 月 | アカウント数 | 投稿頻度 | 日次制作数 | 必要な並列制作数 | 対応方針 |
|----|------------|---------|-----------|---------------|---------|
| 2月 | 50 | 週3回 | ~21/日 | 2-3並列 | v4.0パイプライン (3セクション並列) |
| 3月 | 160 | 週3回 | ~69/日 | 5-7並列 | DB駆動パイプライン + タスクキュー |
| 4月 | 340 | 週3回 | ~146/日 | 10-15並列 | ワーカープール拡大 |
| 5月 | 1,480 | 週3回 | ~634/日 | 50-60並列 | プランナー増設 + ワーカー水平スケール |
| 6月 | 3,500 | 週3回 | ~1,500/日 | 120-150並列 | 大規模プランナー群 + ワーカープール最大化 |

**注**: 1動画の制作時間は~12分 (v4.0実績)。1日の稼働時間を18時間 (6時間メンテナンス) として算出。6月の1,500/日はfal.aiの同時リクエスト制限との兼ね合いで、バッチ実行の最適化が必要。

### 8.3 各フェーズが遅延した場合のKPI影響

| 遅延シナリオ | KPI影響 | 緩和策 |
|------------|---------|--------|
| Phase 1 が1週遅延 | 3月KPI達成がギリギリ | Phase 2の投稿WKとPhase 1のMCP Serverを1日重複して並行開発 |
| Phase 2 が1週遅延 | v4.0パイプラインを延長稼働 | v4.0で160アカウントまでは対応可能 (Sheets運用) |
| Phase 3 が2週遅延 | 4月KPIのAI分析部分が未達 | DB駆動パイプラインは動いているため、制作・投稿は継続。AI分析は手動で補完 |
| Phase 4 が2週遅延 | 5月KPIに直接影響 | YouTube単独で先行稼働。他PFは6月に追加 |
| Phase 5 が2週遅延 | 6月KPI未達のリスク | ダッシュボードなしでも3,500アカウント運用は可能。監視はログベースで代替 |

## 9. 前提条件

### 9.1 開発リソース

| 条件 | 内容 | 備考 |
|------|------|------|
| 開発者 | 1名 (Shungo) フルタイム | 月〜土勤務、日曜休み |
| 稼働時間 | 1日 8-10時間 × 6日/週 = 48-60時間/週 | 祝日は通常稼働 |
| AI支援 | Claude Code (Claude Opus 4.6) による開発支援 | コーディング速度2-3倍を想定 |

### 9.2 インフラ

| 条件 | 内容 | 備考 |
|------|------|------|
| GCE VM | 既存VMを継続使用 | スペック不足時はアップグレード (Phase 5で判断) |
| Docker + Docker Compose | GCE上で稼働 | `docker-compose.dev.yml` / `docker-compose.prod.yml` で環境分離 |
| PostgreSQL (本番) | Cloud SQL (PostgreSQL 16+ / pgvector) | Phase 1から使用。マネージド運用 |
| PostgreSQL (開発) | `pgvector/pgvector:pg16` Dockerコンテナ | ローカル開発・テスト用 |
| PM2 → Docker移行 | Phase 2まで既存PM2、Phase 5 (W18) でDocker完全移行 | PM2は段階的に廃止 |
| ネットワーク | GCEから外部API (fal.ai, YouTube等) への接続 | ファイアウォール設定済み |

### 9.3 外部サービス

| 条件 | 内容 | 備考 |
|------|------|------|
| fal.aiクレジット | 確保済み | 月次で残高確認が必要 |
| Anthropic APIキー | 確保済み (Opus + Sonnet) | LLMコスト月額の承認が必要 |
| Embeddingモデル | OpenAI or Anthropic APIキー | Phase 3開始前に取得 |
| YouTube OAuth | Phase 1から並行申請 | GCPプロジェクト `ai-influencer` を利用 |
| TikTok API審査 | Phase 1から並行申請 | 審査に2-4週間。早期申請が重要 |
| Instagram Graph API | Phase 1から並行申請 | Metaビジネスアカウントの事前取得が必要 |
| X API v2 Premium | 即日利用可 ($8/月/アカウント) | コスト承認が必要 |

### 9.4 技術前提

| 条件 | 内容 |
|------|------|
| v4.0パイプライン | 動作確認済み。orchestrator.js + media/* をそのまま再利用 |
| Node.js 20+ | 既存環境で稼働中 |
| TypeScript | v5.0から新規導入。MCP Server + LangGraphグラフで使用 |
| LangGraph.js v1.0 | GA版。公式ドキュメント・サンプルが利用可能 |
| langchain-mcp-adapters | npm パッケージとして利用可能 |

## 10. 週次レビュー計画

毎週土曜日の作業終了時に以下のレビューを実施する。

| 項目 | 内容 |
|------|------|
| 進捗確認 | 今週の完了タスク vs 計画。未完了タスクの原因分析 |
| バッファ消費 | バッファを使ったか。使った場合、どの作業が想定より時間がかかったか |
| KPI確認 | 当月のKPI目標に対する進捗。アカウント数、稼働状況 |
| リスク更新 | 新たに判明したリスク。外部依存の状況 (API審査等) |
| 翌週計画 | 翌週の詳細作業計画。調整が必要な場合はここで反映 |
| ドキュメント更新 | CONTEXT.mdへのセッション記録、必要に応じてアーキテクチャ文書更新 |
